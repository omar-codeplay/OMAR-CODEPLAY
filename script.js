const translations = {
  "en": {
    "nav_home": "Home",
    "nav_about": "About",
    "nav_projects": "Projects",
    "nav_courses": "Courses",
    "nav_articles": "Articles",
    "nav_contact": "Contact",
    "nav_lang": "عربي",
    "home_subtitle": "Where Gaming Meets Programming",
    "home_title": "Welcome to CodePlay",
    "home_desc": "Explore my projects, tutorials, and articles about <strong>gaming</strong> and <strong>programming</strong>. Join me on my journey to create, learn, and play.",
    "btn_view_projects": "View Projects",
    "btn_contact_me": "Contact Me",
    "about_title": "About Me",
    "about_p1": "Hello! I'm Omar, a passionate developer and gamer who loves blending the two worlds. My journey started with a simple \"Hello, World!\" and quickly evolved into building custom game mechanics in Unity. We will spend our journey learning a new programing language like HTML , CSS , JS and Dart .",
    "about_p2": "This website is my digital playground—a place where I share my creations, document my learning process, and (hopefully) teach others a few things I've picked up along the way.",
    "about_p3": "Whether you're here to grab some code, learn a new skill, or just see what I'm up to, I'm glad to have you.",
    "projects_title": "Projects",
    "project1_title": "Taqyim",
    "project1_desc": "An App made by Java in Sketchware to Alert you when new Taqyim arrives.",
    "project2_title": "CP Color",
    "project2_desc": "An App to save the colors hex code to use it in the feature.",
    "project3_title": "Screen Recorder",
    "project3_desc": "A website to record screen 4k 240fps with no lag.",
    "courses_title": "Courses",
    "course1_title": "Learn HTML & CSS",
    "course1_desc": "Perfect for beginners — understand core concepts and syntax.",
    "course2_title": "Game Dev with Unity",
    "course2_desc": "Create your first 3D game step by step, from idea to playtest.",
    "articles_title": "Articles",
    "article1_title": "Beware of the feature",
    "article1_desc": "The danger of using unclean energy.",
    "article2_title": "Learning Programing",
    "article2_desc": "How to start learning Programming.",
    "contact_title": "Contact & Socials",
    "contact_desc": "Connect with me or follow my work on these platforms:",
    "footer_text": "© 2025 OmarCodePlay — Gaming & Programming",
    "btn_more_projects": "More Projects",
    "btn_more_courses": "More Courses",   
    "btn_more_articles": "More Articles",
    "toast_lang": "Language changed successfully!",
    "toast_theme": "Theme changed successfully!"
  },
  "ar": {
    "nav_home": "الرئيسية",
    "nav_about": "نبذة عني",
    "nav_projects": "المشاريع",
    "nav_courses": "الكورسات",
    "nav_articles": "المقالات",
    "nav_contact": "تواصل معي",
    "nav_lang": "English",
    "home_subtitle": "حيث تلتقي الألعاب بالبرمجة",
    "home_title": "أهلاً بك في CodePlay",
    "home_desc": "استكشف مشاريعي، دروسي، ومقالاتي حول <strong>الألعاب</strong> و <strong>البرمجة</strong>. انضم إلي في رحلتي للإبداع، التعلم، واللعب.",
    "btn_view_projects": "عرض المشاريع",
    "btn_contact_me": "تواصل معي",
    "about_title": "نبذة عني",
    "about_p1": "مرحباً! أنا عمر، مطور ولاعب شغوف أحب المزج بين العالمين. بدأت رحلتي بـ \"Hello, World!\" بسيطة وتطورت سريعاً لبناء آليات ألعاب مخصصة في Unity. سنقضي رحلتنا في تعلم لغات برمجة جديدة مثل HTML و CSS و JS و Dart.",
    "about_p2": "هذا الموقع هو ملعبي الرقمي، مكان أشارك فيه إبداعاتي، وأوثق عملية تعلمي، وآمل أن أُعلّم الآخرين بعض الأشياء التي اكتسبتها على طول الطريق.",
    "about_p3": "سواء كنت هنا للحصول على كود، أو لتعلم مهارة جديدة، أو لمجرد رؤية ما أفعله، أنا سعيد بوجودك.",
    "projects_title": "المشاريع",
    "project1_title": "تـقـيـيـم",
    "project1_desc": "تطبيق مصنوع بلغة Java في Sketchware لتنبيهك بوصول تقييمات جديدة.",
    "project2_title": "CP Color",
    "project2_desc": "تطبيق لحفظ أكواد الألوان السداسية (Hex Code) لاستخدامها لاحقاً.",
    "project3_title": "مسجل الشاشة",
    "project3_desc": "موقع لتسجيل الشاشة بجودة 4K و 240 إطارًا في الثانية بدون تأخير.",
    "courses_title": "الكورسات",
    "course1_title": "تعلم أساسيات HTML و CSS",
    "course1_desc": "مثالي للمبتدئين — لفهم المفاهيم الأساسية وبناء الجملة.",
    "course2_title": "تطوير الألعاب بـ Unity",
    "course2_desc": "أنشئ لعبتك ثلاثية الأبعاد الأولى خطوة بخطوة، من الفكرة إلى الاختبار.",
    "articles_title": "المقالات",
    "article1_title": "احذر من المستقبل", 
    "article1_desc": "خطر استخدام الطاقة غير النظيفة.",
    "article2_title": "تعلم البرمجة",
    "article2_desc": "كيف تبدأ تعلم البرمجة.",
    "contact_title": "تواصل معي",
    "contact_desc": "تواصل معي أو تابع أعمالي على هذه المنصات:",
    "footer_text": "© 2025 OmarCodePlay — ألعاب وبرمجة",
    "btn_more_projects": "المزيد من المشاريع", 
    "btn_more_courses": "المزيد من الكورسات",   
    "btn_more_articles": "المزيد من المقالات",
    "toast_lang": "تم تغيير اللغة بنجاح!",
    "toast_theme": "تم تغيير السمة بنجاح!"
  }
};

const langSwitcher = document.getElementById('lang-switcher');
const htmlEl = document.documentElement;
const bodyEl = document.body;
const header = document.getElementById('mainHeader');
const progressBar = document.getElementById('progressBar');
const backToTop = document.getElementById('backToTop');
const themeToggle = document.getElementById('themeToggle');
const toast = document.getElementById('toast');
const toastMessage = document.getElementById('toastMessage');
const particlesContainer = document.getElementById('particles');
const parallaxBg = document.querySelector('.parallax-bg');

// ----------------------------------------------------
// 1. نظام الألوان الفاتح/الداكن
// ----------------------------------------------------
function toggleTheme() {
  const currentTheme = htmlEl.getAttribute('data-theme');
  const newTheme = currentTheme === 'light' ? 'dark' : 'light';
  
  htmlEl.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme);
  
  // تحديث الأيقونة
  const themeIcon = themeToggle.querySelector('i');
  themeIcon.className = newTheme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
  
  showToast('toast_theme');
}

// التحقق من السمة المحفوظة
(function checkStoredTheme() {
  const savedTheme = localStorage.getItem('theme') || 'dark';
  htmlEl.setAttribute('data-theme', savedTheme);
  
  // تحديث الأيقونة بناءً على السمة
  const themeIcon = themeToggle.querySelector('i');
  themeIcon.className = savedTheme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
})();

// ----------------------------------------------------
// 2. العناصر العائمة المتفاعلة
// ----------------------------------------------------
function initFloatingElements() {
  const floatingElements = document.querySelectorAll('.floating-element');
  
  document.addEventListener('mousemove', (e) => {
    const mouseX = e.clientX / window.innerWidth;
    const mouseY = e.clientY / window.innerHeight;
    
    floatingElements.forEach((el, index) => {
      const speed = (index + 1) * 0.5;
      const x = (mouseX - 0.5) * 20 * speed;
      const y = (mouseY - 0.5) * 20 * speed;
      
      el.style.transform = `translate(${x}px, ${y}px)`;
    });
  });
}

// ----------------------------------------------------
// 3. تأثير Parallax للخلفية
// ----------------------------------------------------
function initParallax() {
  window.addEventListener('scroll', () => {
    const scrolled = window.pageYOffset;
    const rate = scrolled * -0.5;
    
    if (parallaxBg) {
      parallaxBg.style.transform = `translate3d(0px, ${rate}px, 0px)`;
    }
  });
}

// ----------------------------------------------------
// 4. تحسين تحميل الصور - إزالة Lazy Loading المعقد
// ----------------------------------------------------
function initImageLoading() {
  // إضافة تأثير تحميل بسيط للصور
  document.querySelectorAll('img').forEach(img => {
    // إذا كانت الصورة محملة بالفعل
    if (img.complete) {
      img.style.opacity = '1';
    } else {
      // إذا لم تكن محملة بعد، إضافة تأثير ظهور
      img.style.opacity = '0';
      img.style.transition = 'opacity 0.5s ease';
      img.onload = function() {
        this.style.opacity = '1';
      };
    }
  });
}

// ----------------------------------------------------
// 5. Service Worker للتخزين المؤقت
// ----------------------------------------------------
function registerServiceWorker() {
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js')
      .then(registration => {
        console.log('SW registered: ', registration);
      })
      .catch(registrationError => {
        console.log('SW registration failed: ', registrationError);
      });
  }
}

// ----------------------------------------------------
// 6. الدالة الأساسية لتطبيق الترجمة
// ----------------------------------------------------
function applyLanguage(lang) {
    // Set the primary attributes on the <html> element
    htmlEl.setAttribute('lang', lang);
    htmlEl.setAttribute('dir', lang === 'ar' ? 'rtl' : 'ltr');
    
    // Set the class on the <body> element for CSS
    bodyEl.className = `lang-${lang}`;

    const elementsToTranslate = document.querySelectorAll('[data-key]');
    
    elementsToTranslate.forEach(el => {
        const key = el.getAttribute('data-key');
        const translation = translations[lang][key];
        
        if (translation) {
            // Using innerHTML handles the <strong> tag in home_desc
            el.innerHTML = translation; 
        }
    });
}

// ----------------------------------------------------
// 7. الدالة المسؤولة عن تبديل وحفظ اللغة
// ----------------------------------------------------
function toggleLanguage() {
    const currentLang = htmlEl.getAttribute('lang');
    const newLang = currentLang === 'en' ? 'ar' : 'en';

    // تطبيق اللغة الجديدة
    applyLanguage(newLang);
    
    // حفظ اللغة الجديدة في التخزين المحلي
    localStorage.setItem('userLang', newLang);
    
    // Show toast notification
    showToast('toast_lang');
}

// ----------------------------------------------------
// 8. التحقق عند تحميل الصفحة (تطبيق اللغة المحفوظة)
// ----------------------------------------------------
(function checkStoredLanguage() {
    // التحقق من وجود لغة محفوظة أو استخدام الافتراضية 'en'
    const storedLang = localStorage.getItem('userLang');
    const initialLang = storedLang || 'en';
    
    // تطبيق اللغة المحفوظة أو الافتراضية
    applyLanguage(initialLang);
    
    // Ensure the correct lang attribute is set initially
    htmlEl.setAttribute('lang', initialLang);
})();

// ----------------------------------------------------
// 9. تأثير التمرير على الهيدر وشريط التقدم
// ----------------------------------------------------
window.addEventListener('scroll', () => {
    // Header scroll effect
    if (window.scrollY > 50) {
        header.classList.add('scrolled');
    } else {
        header.classList.remove('scrolled');
    }
    
    // Progress bar
    const winHeight = window.innerHeight;
    const docHeight = document.documentElement.scrollHeight;
    const scrollTop = window.pageYOffset;
    const scrollPercent = (scrollTop / (docHeight - winHeight)) * 100;
    progressBar.style.width = scrollPercent + '%';
    
    // Back to top button
    if (window.scrollY > 500) {
        backToTop.classList.add('visible');
    } else {
        backToTop.classList.remove('visible');
    }
});

// ----------------------------------------------------
// 10. تأثيرات الظهور عند التمرير
// ----------------------------------------------------
function checkScroll() {
    const fadeElements = document.querySelectorAll('.fade-in');
    
    fadeElements.forEach(element => {
        const elementTop = element.getBoundingClientRect().top;
        const elementVisible = 150;
        
        if (elementTop < window.innerHeight - elementVisible) {
            element.style.opacity = "1";
            element.style.transform = "translateY(0)";
        }
    });
}

// Initialize elements with opacity 0 for animation
document.querySelectorAll('.fade-in').forEach(el => {
    el.style.opacity = "0";
    el.style.transform = "translateY(30px)";
    el.style.transition = "opacity 0.8s ease, transform 0.8s ease";
});

window.addEventListener('scroll', checkScroll);
window.addEventListener('load', checkScroll);

// ----------------------------------------------------
// 11. Back to Top functionality
// ----------------------------------------------------
backToTop.addEventListener('click', () => {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
});

// ----------------------------------------------------
// 12. Toast Notification functionality
// ----------------------------------------------------
function showToast(messageKey) {
    toastMessage.textContent = translations[htmlEl.getAttribute('lang')][messageKey];
    toast.classList.add('visible');
    
    setTimeout(() => {
        toast.classList.remove('visible');
    }, 3000);
}

// ----------------------------------------------------
// 13. Particle Background
// ----------------------------------------------------
function createParticles() {
    const particleCount = 30;
    
    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        
        // Random properties
        const size = Math.random() * 3 + 1;
        const posX = Math.random() * 100;
        const posY = Math.random() * 100;
        const delay = Math.random() * 15;
        const duration = Math.random() * 10 + 10;
        
        // Apply properties
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${posX}%`;
        particle.style.top = `${posY}%`;
        particle.style.animationDelay = `${delay}s`;
        particle.style.animationDuration = `${duration}s`;
        
        particlesContainer.appendChild(particle);
    }
}

// ----------------------------------------------------
// 14. Google Analytics
// ----------------------------------------------------
function initGoogleAnalytics() {
  // Replace with your GA4 measurement ID
  const GA_MEASUREMENT_ID = 'G-3XK98YF9PW';
  
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', GA_MEASUREMENT_ID);
}

// ----------------------------------------------------
// 15. نظام متابعة الزوار
// ----------------------------------------------------
function initVisitorTracking() {
  const stats = JSON.parse(localStorage.getItem('visitorStats') || '{"pageViews": 0, "lastVisit": null}');
  
  // زيادة عدد المشاهدات
  stats.pageViews = (stats.pageViews || 0) + 1;
  stats.lastVisit = new Date().toISOString();
  
  localStorage.setItem('visitorStats', JSON.stringify(stats));
  
  // تتبع النقرات
  document.addEventListener('click', (e) => {
    const target = e.target.closest('a');
    if (target) {
      const linkStats = JSON.parse(localStorage.getItem('linkStats') || '{}');
      const href = target.getAttribute('href');
      linkStats[href] = (linkStats[href] || 0) + 1;
      localStorage.setItem('linkStats', JSON.stringify(linkStats));
    }
  });
  
  // تتبع التمرير
  let maxScroll = 0;
  window.addEventListener('scroll', () => {
    const currentScroll = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
    if (currentScroll > maxScroll) {
      maxScroll = currentScroll;
      localStorage.setItem('maxScrollDepth', Math.round(maxScroll));
    }
  });
}

// ----------------------------------------------------
// 16. تهيئة جميع الميزات
// ----------------------------------------------------
function initAllFeatures() {
  initFloatingElements();
  initParallax();
  initImageLoading();
  registerServiceWorker();
  createParticles();
  initGoogleAnalytics();
  initVisitorTracking();
}

// ----------------------------------------------------
// 17. إضافة مستمعي الأحداث
// ----------------------------------------------------
document.addEventListener('DOMContentLoaded', () => {
  initAllFeatures();
});

langSwitcher.addEventListener('click', (e) => {
  e.preventDefault();
  toggleLanguage();
});

themeToggle.addEventListener('click', toggleTheme);

// Smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href');
        if (targetId === '#') return;
        
        const targetElement = document.querySelector(targetId);
        if (targetElement) {
            const headerHeight = header.offsetHeight;
            const targetPosition = targetElement.offsetTop - headerHeight;
            
            window.scrollTo({
                top: targetPosition,
                behavior: 'smooth'
            });
        }
    });
});
